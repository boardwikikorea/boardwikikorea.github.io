import{O as j,q as O,d as $,c as n,b as a,i as m,t as l,o as r,B as G,a as g,u as P,r as _,f as B,F as q,h as z,k as C,P as N,v as H,e as s,g as U,G as F,m as i,y as W,A as c,D as Y,z as Z}from"./index-C8MIvzQL.js";import{f as J}from"./profile-DS78xICa.js";import{c as K}from"./eventPublic-z-COBmXQ.js";import{a as Q}from"./eventPublicRegistration-9uFfp0Uo.js";import{f as X,a as ee}from"./eventTerms-U3kJyNGh.js";const te=j("profile",{state:()=>({profile:null,loading:!1,_loadedUserId:null}),getters:{isReady:u=>!!u.profile},actions:{async loadMyProfile(){const e=O().user;if(!e){this.$reset();return}if(!(this._loadedUserId===e.id&&this.profile)){this.loading=!0;try{const d=await J(e.id);this.profile=d,this._loadedUserId=e.id}catch(d){console.error("[profileStore] load failed",d),this.profile=null,this._loadedUserId=null}finally{this.loading=!1}}},resetProfile(){this.$reset()}}}),le={class:"font-bold text-[22px] lg:text-[32px]"},ae={class:"text-[var(--btn-primary-bg)]"},se=$({__name:"SubTitle",props:{title:{},subTitle:{}},setup(u){return(e,d)=>(r(),n("h2",le,[a("span",ae,l(u.title),1),m(" "+l(u.subTitle),1)]))}}),oe={class:"text-[16px] font-bold tracking-[-0.05em] text-black dark:text-white flex flex-row gap-2"},re={class:"font-normal"},E=$({__name:"InfoItem",props:{label:{},value:{}},setup(u){return(e,d)=>(r(),n("p",oe,[m(l(u.label)+" ",1),a("span",re,[G(e.$slots,"default",{},()=>[m(l(u.value),1)])])]))}}),ne={class:"border border-default bg-surface px-5 lg:px-8 py-4 lg:py-7"},ue={key:0,class:"text-xl font-bold mb-4 text-foreground border-b-2 border-default pb-[15px]"},D=$({__name:"BaseBorderBox",props:{title:{default:""}},setup(u){return(e,d)=>(r(),n("article",ne,[u.title?(r(),n("h4",ue,l(u.title),1)):g("",!0),G(e.$slots,"default")]))}}),ie={class:"flex flex-col gap-4"},ce={class:"flex items-start gap-3 cursor-pointer"},de=["onUpdate:modelValue"],pe={class:"flex-1"},me={class:"font-semibold text-foreground"},fe={key:0,class:"text-sm text-muted-foreground"},ve={key:0,class:"mt-3"},_e=["onUpdate:modelValue","placeholder"],be=$({__name:"EventApplyOptionList",props:{options:{}},emits:["update"],setup(u,{emit:e}){const{t:d}=P(),x=e,b=_({}),y=_({});return B([b,y],()=>{const o=Object.keys(b.value).filter(f=>b.value[f]).map(f=>({optionId:f,musicText:y.value[f]||void 0}));x("update",o)},{deep:!0}),(o,f)=>(r(),n("div",ie,[(r(!0),n(q,null,z(u.options,p=>(r(),n("div",{key:p.id,class:"border border-default bg-surface px-4 py-3 rounded-md"},[a("label",ce,[C(a("input",{type:"checkbox","onUpdate:modelValue":h=>b.value[p.id]=h,class:"mt-1 accent-foreground"},null,8,de),[[N,b.value[p.id]]]),a("div",pe,[a("p",me,l(p.name),1),p.optionCategory?(r(),n("p",fe,l(p.optionCategory),1)):g("",!0)])]),p.musicRequestUse&&b.value[p.id]?(r(),n("div",ve,[C(a("input",{"onUpdate:modelValue":h=>y.value[p.id]=h,type:"text",placeholder:s(d)("event.option.placeholder.musicRequest"),class:"w-full border border-default bg-background px-3 py-2 rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20"},null,8,_e),[[H,y.value[p.id]]])])):g("",!0)]))),128))]))}}),he={key:0,class:"max-w-[1280px] mx-auto py-10 px-5 lg:px-0 flex flex-col gap-10 bg-background text-foreground"},ge={class:"flex flex-col lg:flex-row gap-8"},xe={class:"w-full lg:w-[320px] h-[200px] bg-muted border border-default flex items-center justify-center"},ye=["src"],Ee={key:1,class:"text-muted-foreground text-sm"},ke={class:"flex-1 space-y-2"},Te={class:"text-2xl font-bold text-foreground"},we={key:0,class:"grid md:grid-cols-2 gap-6"},$e={class:"space-y-6 text-sm text-foreground"},Re={key:0},Ie={class:"font-semibold mb-2"},Se={class:"whitespace-pre-line text-muted-foreground mb-3"},Ae={class:"flex items-center gap-2"},Ue={key:1},De={class:"font-semibold mb-2"},Be={class:"whitespace-pre-line text-muted-foreground mb-3"},Ce={class:"flex items-center gap-2"},Le=$({__name:"EventApplyView",setup(u){const{t:e}=P(),d=F(),x=Z(),b=O(),y=te(),o=_(null),f=U(()=>d.params.nameEn);B(f,async()=>{if(!f.value)return;const t=await K(f.value);if(!t){x.replace({name:"error"});return}if(!t.registration_use){alert(e("user.event.apply.error.notAvailable")),x.replace({name:"event-detail",params:{nameEn:f.value}});return}o.value=t},{immediate:!0}),U(()=>h.value&&R.value&&!T.value);const h=_(!1),R=_(!1),I=_(null),S=_(null),{locale:L}=P(),A=U(()=>{switch(L.value){case"ko":return"KR";case"ja":return"JA";case"zh":return"ZH";case"zh-TW":return"ZH-TW";case"en":default:return"EN"}});B([o,A],async()=>{if(!o.value||!A.value)return;I.value=await X(A.value);const t=await ee(o.value.id);S.value=t.find(v=>v.country_code===A.value)??null},{immediate:!0}),B(()=>b.user,t=>{if(!t){x.replace({name:"login",query:{redirect:d.fullPath}});return}y.loadMyProfile()},{immediate:!0});const k=U(()=>y.profile),V=_([]),T=_(!1),M=async()=>{if(!(!o.value||T.value)){if(!h.value||!R.value){alert(e("user.event.terms.error.mustAgree"));return}T.value=!0;try{await Q(o.value.id,V.value),alert(e("user.event.apply.success.completed")),x.replace({name:"event-my-registrations"})}catch(t){console.error(t);const v=(t==null?void 0:t.message)==="ALREADY_REGISTERED"?e("user.event.apply.error.alreadyRegistered"):(t==null?void 0:t.message)==="REGISTRATION_NOT_STARTED"?e("user.event.apply.error.notStarted"):(t==null?void 0:t.message)==="REGISTRATION_ENDED"?e("user.event.apply.error.ended"):(t==null?void 0:t.message)==="REGISTRATION_DISABLED"?e("user.event.apply.error.disabled"):e("user.event.apply.error.unknown");alert(v),(t==null?void 0:t.message)==="ALREADY_REGISTERED"&&x.replace({name:"event-my-registrations"})}finally{T.value=!1}}};return(t,v)=>o.value?(r(),n("section",he,[i(se,{title:s(e)("user.event.apply.title.event"),"sub-title":s(e)("user.event.apply.title.apply")},null,8,["title","sub-title"]),i(D,{title:s(e)("user.event.section.eventInfo")},{default:c(()=>[a("div",ge,[a("div",xe,[o.value.thumbnailUrl?(r(),n("img",{key:0,src:o.value.thumbnailUrl,class:"w-full h-full object-cover"},null,8,ye)):(r(),n("div",Ee,l(s(e)("user.event.placeholder.noImage")),1))]),a("div",ke,[a("h3",Te,l(o.value.title),1),i(E,{label:s(e)("event.common.register.eventPeriod")},{default:c(()=>[m(l(o.value.periodText),1)]),_:1},8,["label"]),i(E,{label:s(e)("event.common.register.applyPeriod")},{default:c(()=>[m(l(o.value.applyPeriodText),1)]),_:1},8,["label"]),i(E,{label:s(e)("user.event.label.price")},{default:c(()=>[m(l(o.value.payinfoHtml?s(e)("user.event.label.paid"):s(e)("user.event.label.free")),1)]),_:1},8,["label"])])])]),_:1},8,["title"]),i(D,{title:s(e)("user.event.section.applicantInfo")},{default:c(()=>[k.value?(r(),n("div",we,[i(E,{label:s(e)("user.event.label.name")},{default:c(()=>[m(l(k.value.name),1)]),_:1},8,["label"]),i(E,{label:s(e)("user.event.label.nickname")},{default:c(()=>[m(l(k.value.nickname),1)]),_:1},8,["label"]),i(E,{label:s(e)("user.event.label.gender")},{default:c(()=>[m(l(k.value.gender),1)]),_:1},8,["label"]),i(E,{label:s(e)("user.event.label.nationality")},{default:c(()=>[m(l(k.value.nationality),1)]),_:1},8,["label"])])):g("",!0)]),_:1},8,["title"]),o.value.options.length?(r(),W(D,{key:0,title:s(e)("event.option.section.available")},{default:c(()=>[i(be,{options:o.value.options,onUpdate:v[0]||(v[0]=w=>V.value=w)},null,8,["options"])]),_:1},8,["title"])):g("",!0),i(D,{title:s(e)("user.event.section.terms")},{default:c(()=>[a("div",$e,[I.value?(r(),n("div",Re,[a("h4",Ie,l(I.value.title),1),a("div",Se,l(I.value.content),1),a("label",Ae,[C(a("input",{type:"checkbox","onUpdate:modelValue":v[1]||(v[1]=w=>h.value=w)},null,512),[[N,h.value]]),a("span",null,l(s(e)("user.event.terms.agreeCommon")),1)])])):g("",!0),S.value?(r(),n("div",Ue,[a("h4",De,l(S.value.title),1),a("div",Be,l(S.value.content),1),a("label",Ce,[C(a("input",{type:"checkbox","onUpdate:modelValue":v[2]||(v[2]=w=>R.value=w)},null,512),[[N,R.value]]),a("span",null,l(s(e)("user.event.terms.agreeEvent")),1)])])):g("",!0)])]),_:1},8,["title"]),i(Y,{size:"xlarge",type:"primary",class:"w-full",loading:T.value,onClick:M},{default:c(()=>[m(l(s(e)("user.event.apply.button.submit")),1)]),_:1},8,["loading"])])):g("",!0)}});export{Le as default};
