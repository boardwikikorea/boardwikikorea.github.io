import{w as s,s as r,M as a}from"./index-DfXFToxP.js";async function o(){return s(async()=>{const{data:t,error:e}=await r.from("event").select(`
        id,
        name,
        name_en,
        open,
        start_date,
        end_date,
        registration_use,
        registration_start_at,
        registration_end_at,
        status,
        event_cate,
        created_at
      `).order("created_at",{ascending:!1});if(e)throw e;return t??[]})}async function c(t){return s(async()=>{const{data:e,error:n}=await r.from("event").select("*").eq("id",t).single();if(n)throw n;return e})}async function d(t){return s(async()=>{const e={name:t},{data:n,error:i}=await r.from("event").insert(e).select("id").single();if(i)throw i;return n.id})}async function l(t,e){return s(async()=>{const{error:n}=await r.from("event").update(e).eq("id",t);if(n)throw n})}async function f(t){return s(async()=>{const{data:e,error:n}=await r.from("event_link").select("*").eq("event_id",t).order("sort_order").order("created_at");if(n)throw n;return e??[]})}async function u(t){return s(async()=>{const{data:e,error:n}=await r.from("event_link").insert(t).select("*").single();if(n)throw n;return e})}async function h(t){return s(async()=>{const{error:e}=await r.from("event_link").delete().eq("id",t);if(e)throw e})}async function y(t){return s(async()=>{const{data:e,error:n}=await r.from("event_option").select("*").eq("event_id",t).order("sort_order").order("created_at");if(n)throw n;return e??[]})}async function w(t){return s(async()=>{const{data:e,error:n}=await r.from("event_option").insert(t).select("*").single();if(n)throw n;return e})}async function v(t){return s(async()=>{const{error:e}=await r.from("event_option").delete().eq("id",t);if(e)throw e})}async function _(t){return s(async()=>{const{data:e,error:n}=await r.from("event_schedule").select("*").eq("event_id",t).order("schedule_date").order("sort_order").order("start_time").order("created_at");if(n)throw n;return e??[]})}async function p(t){return s(async()=>{const{data:e,error:n}=await r.from("event_schedule").insert(t).select("*").single();if(n)throw n;return e})}async function g(t){return s(async()=>{const{error:e}=await r.from("event_schedule").delete().eq("id",t);if(e)throw e})}async function m(t){return s(async()=>{const{data:e,error:n}=await r.from("event_content").select("id,event_id,locale,content,payinfo").eq("event_id",t).order("locale",{ascending:!0});if(n)throw n;return e??[]})}async function L(t){return s(async()=>{const{data:e,error:n}=await r.from("event_content").upsert(t,{onConflict:"event_id,locale"}).select("id,event_id,locale,content,payinfo").single();if(n)throw n;return e})}const E=a("admin-event",{state:()=>({events:[],contents:[],currentEvent:null,links:[],options:[],schedules:[],contentsLoading:!1,loading:!1,linksLoading:!1,optionsLoading:!1,schedulesLoading:!1}),getters:{contentsByLocale:t=>{const e={};for(const n of t.contents)e[n.locale]={content:n.content??null,payinfo:n.payinfo??null};return e}},actions:{async fetchEvents(){this.loading=!0;try{this.events=await o()}finally{this.loading=!1}},async createDraftEvent(t){return await d(t)},async fetchEventDetail(t){this.loading=!0;try{this.currentEvent=await c(t),await Promise.all([this.fetchLinks(t),this.fetchOptions(t),this.fetchSchedules(t),this.fetchEventContents(t)])}finally{this.loading=!1}},async updateEvent(t,e){await l(t,e),this.currentEvent&&this.currentEvent.id===t&&Object.assign(this.currentEvent,e)},async fetchEventContents(t){this.contentsLoading=!0;try{this.contents=await m(t)}finally{this.contentsLoading=!1}},async upsertEventContent(t){const e=await L({event_id:t.eventId,locale:t.locale,content:t.content,payinfo:t.payinfo}),n=this.contents.findIndex(i=>i.event_id===e.event_id&&i.locale===e.locale);return n>=0?this.contents[n]=e:this.contents.push(e),e},async fetchLinks(t){this.linksLoading=!0;try{this.links=await f(t)}finally{this.linksLoading=!1}},async addLink(t,e){const n=await u({event_id:t,type:e.type,title:e.title,link:e.link});return this.links.push(n),n},async deleteLink(t){await h(t),this.links=this.links.filter(e=>e.id!==t)},async fetchOptions(t){this.optionsLoading=!0;try{this.options=await y(t)}finally{this.optionsLoading=!1}},async addOption(t,e){const n=await w({event_id:t,...e});return this.options.push(n),n},async deleteOption(t){await v(t),this.options=this.options.filter(e=>e.id!==t)},async fetchSchedules(t){this.schedulesLoading=!0;try{this.schedules=await _(t)}finally{this.schedulesLoading=!1}},async addSchedule(t,e){const n=await p({event_id:t,...e});return this.schedules.push(n),n},async deleteSchedule(t){await g(t),this.schedules=this.schedules.filter(e=>e.id!==t)}}});export{E as u};
