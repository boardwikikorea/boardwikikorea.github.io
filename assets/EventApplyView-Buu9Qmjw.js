import{O as U,u as $,d as E,c as n,a as t,b as c,t as s,o as i,E as D,l as b,m as k,F as N,r as A,f as y,v as T,P,x as V,p as S,H as B,e as f,w as v,B as O,D as C}from"./index-DyAQ8r7k.js";import{f as M}from"./profile-CjFGcgjH.js";import{c as G}from"./eventPublic-DJnKxX3i.js";import{a as L}from"./eventPublicRegistration-D9sIcbOY.js";const j=U("profile",{state:()=>({profile:null,loading:!1,_loadedUserId:null}),getters:{isReady:u=>!!u.profile},actions:{async loadMyProfile(){const a=$().user;if(!a){this.$reset();return}if(!(this._loadedUserId===a.id&&this.profile)){this.loading=!0;try{const o=await M(a.id);this.profile=o,this._loadedUserId=a.id}catch(o){console.error("[profileStore] load failed",o),this.profile=null,this._loadedUserId=null}finally{this.loading=!1}}},resetProfile(){this.$reset()}}}),q={class:"font-bold text-[22px] lg:text-[32px]"},F={class:"text-[var(--btn-primary-bg)]"},H=E({__name:"SubTitle",props:{title:{},subTitle:{}},setup(u){return(a,o)=>(i(),n("h2",q,[t("span",F,s(u.title),1),c(" "+s(u.subTitle),1)]))}}),z={class:"text-[16px] font-bold tracking-[-0.05em] text-black dark:text-white flex flex-row gap-2"},Y={class:"font-normal"},h=E({__name:"InfoItem",props:{label:{},value:{}},setup(u){return(a,o)=>(i(),n("p",z,[c(s(u.label)+" ",1),t("span",Y,[D(a.$slots,"default",{},()=>[c(s(u.value),1)])])]))}}),J={class:"flex flex-col gap-4"},K={class:"flex items-start gap-3 cursor-pointer"},Q=["onUpdate:modelValue"],W={class:"flex-1"},X={class:"font-semibold"},Z={key:0,class:"text-sm text-neutral-500"},ee={key:0,class:"mt-3"},te=["onUpdate:modelValue"],le=E({__name:"EventApplyOptionList",props:{options:{}},emits:["update"],setup(u,{emit:a}){const o=a,_=b({}),x=b({});return k([_,x],()=>{const l=Object.keys(_.value).filter(p=>_.value[p]).map(p=>({optionId:p,musicText:x.value[p]||void 0}));o("update",l)},{deep:!0}),(l,p)=>(i(),n("div",J,[(i(!0),n(N,null,A(u.options,d=>(i(),n("div",{key:d.id,class:"border border-black/20 px-4 py-3 rounded-md"},[t("label",K,[T(t("input",{type:"checkbox","onUpdate:modelValue":m=>_.value[d.id]=m,class:"mt-1"},null,8,Q),[[P,_.value[d.id]]]),t("div",W,[t("p",X,s(d.name),1),d.optionCategory?(i(),n("p",Z,s(d.optionCategory),1)):y("",!0)])]),d.musicRequestUse&&_.value[d.id]?(i(),n("div",ee,[T(t("input",{"onUpdate:modelValue":m=>x.value[d.id]=m,type:"text",placeholder:"음악 요청 사항 (선택)",class:"w-full border border-neutral-300 px-3 py-2 rounded-md text-sm"},null,8,te),[[V,x.value[d.id]]])])):y("",!0)]))),128))]))}}),se={key:0,class:"max-w-[1280px] m-auto py-10 px-5 lg:px-0 flex flex-col gap-10"},ae={class:"border-2 border-black px-8 py-7 bg-white"},oe={class:"flex flex-col lg:flex-row gap-8"},re={class:"w-full lg:w-[320px] h-[200px] bg-neutral-100"},ne=["src"],ie={key:1,class:"w-full h-full flex items-center justify-center text-neutral-400"},ue={class:"flex-1 space-y-2"},de={class:"text-2xl font-bold"},ce={class:"border-2 border-black px-8 py-7 bg-white"},pe={key:0,class:"grid md:grid-cols-2 gap-6"},fe={key:0,class:"border-2 border-black px-8 py-7 bg-white"},he=E({__name:"EventApplyView",setup(u){const a=B(),o=C(),_=$(),x=j(),l=b(null),p=S(()=>a.params.nameEn);k(p,async()=>{if(!p.value)return;const e=await G(p.value);if(!e){o.replace({name:"error"});return}if(!e.registration_use){alert("신청이 불가능한 이벤트입니다."),o.replace({name:"event-detail",params:{nameEn:p.value}});return}l.value=e},{immediate:!0}),k(()=>_.user,e=>{if(!e){o.replace({name:"login",query:{redirect:a.fullPath}});return}x.loadMyProfile()},{immediate:!0});const m=S(()=>x.profile),w=b([]),g=b(!1),I=async()=>{if(!(!l.value||g.value)){g.value=!0;try{await L(l.value.id,w.value),alert("이벤트 신청이 완료되었습니다."),o.replace({name:"event-my-registrations"})}catch(e){console.error(e);const r=(e==null?void 0:e.message)==="ALREADY_REGISTERED"?"이미 신청한 이벤트입니다.":(e==null?void 0:e.message)==="REGISTRATION_NOT_STARTED"?"신청 기간이 아직 시작되지 않았습니다.":(e==null?void 0:e.message)==="REGISTRATION_ENDED"?"신청 기간이 종료되었습니다.":(e==null?void 0:e.message)==="REGISTRATION_DISABLED"?"현재 신청이 불가능한 이벤트입니다.":"신청 중 오류가 발생했습니다.";alert(r)}finally{g.value=!1}}};return(e,r)=>l.value?(i(),n("section",se,[f(H,{title:"이벤트","sub-title":"신청"}),t("article",ae,[r[1]||(r[1]=t("h4",{class:"text-xl font-bold mb-4"},"이벤트 정보",-1)),t("div",oe,[t("div",re,[l.value.thumbnailUrl?(i(),n("img",{key:0,src:l.value.thumbnailUrl,class:"w-full h-full object-cover"},null,8,ne)):(i(),n("div",ie," No Image "))]),t("div",ue,[t("h3",de,s(l.value.title),1),f(h,{label:"이벤트 기간"},{default:v(()=>[c(s(l.value.periodText),1)]),_:1}),f(h,{label:"신청 기간"},{default:v(()=>[c(s(l.value.applyPeriodText),1)]),_:1}),f(h,{label:"비용"},{default:v(()=>[c(s(l.value.payinfoHtml?"유료":"무료"),1)]),_:1})])])]),t("article",ce,[r[2]||(r[2]=t("h4",{class:"text-xl font-bold mb-4"},"신청자 정보",-1)),m.value?(i(),n("div",pe,[f(h,{label:"이름"},{default:v(()=>[c(s(m.value.name),1)]),_:1}),f(h,{label:"닉네임"},{default:v(()=>[c(s(m.value.nickname),1)]),_:1}),f(h,{label:"성별"},{default:v(()=>[c(s(m.value.gender),1)]),_:1}),f(h,{label:"국적"},{default:v(()=>[c(s(m.value.nationality),1)]),_:1})])):y("",!0)]),l.value.options.length?(i(),n("article",fe,[r[3]||(r[3]=t("h4",{class:"text-xl font-bold mb-4"},"이벤트 옵션",-1)),f(le,{options:l.value.options,onUpdate:r[0]||(r[0]=R=>w.value=R)},null,8,["options"])])):y("",!0),f(O,{size:"xlarge",type:"primary",class:"w-full",loading:g.value,onClick:I},{default:v(()=>[...r[4]||(r[4]=[c(" 신청 완료 ",-1)])]),_:1},8,["loading"])])):y("",!0)}});export{he as default};
