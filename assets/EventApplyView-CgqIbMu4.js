import{M as P,q as A,d as E,c as n,b as f,i as p,t as a,o as r,B as D,a as x,u as B,r as y,f as R,F as V,h as C,k as T,N as O,v as M,e as l,g as w,E as G,m as i,y as L,A as c,D as q,z as j}from"./index-Cs5pcfl0.js";import{f as z}from"./profile-BPznZCJ9.js";import{c as F}from"./eventPublic-DICkvUiP.js";import{a as Y}from"./eventPublicRegistration-B7Hs3fDp.js";const H=P("profile",{state:()=>({profile:null,loading:!1,_loadedUserId:null}),getters:{isReady:o=>!!o.profile},actions:{async loadMyProfile(){const e=A().user;if(!e){this.$reset();return}if(!(this._loadedUserId===e.id&&this.profile)){this.loading=!0;try{const u=await z(e.id);this.profile=u,this._loadedUserId=e.id}catch(u){console.error("[profileStore] load failed",u),this.profile=null,this._loadedUserId=null}finally{this.loading=!1}}},resetProfile(){this.$reset()}}}),J={class:"font-bold text-[22px] lg:text-[32px]"},K={class:"text-[var(--btn-primary-bg)]"},Q=E({__name:"SubTitle",props:{title:{},subTitle:{}},setup(o){return(e,u)=>(r(),n("h2",J,[f("span",K,a(o.title),1),p(" "+a(o.subTitle),1)]))}}),W={class:"text-[16px] font-bold tracking-[-0.05em] text-black dark:text-white flex flex-row gap-2"},X={class:"font-normal"},h=E({__name:"InfoItem",props:{label:{},value:{}},setup(o){return(e,u)=>(r(),n("p",W,[p(a(o.label)+" ",1),f("span",X,[D(e.$slots,"default",{},()=>[p(a(o.value),1)])])]))}}),Z={class:"border border-default bg-surface px-5 lg:px-8 py-4 lg:py-7"},ee={key:0,class:"text-xl font-bold mb-4 text-foreground border-b-2 border-default pb-[15px]"},I=E({__name:"BaseBorderBox",props:{title:{default:""}},setup(o){return(e,u)=>(r(),n("article",Z,[o.title?(r(),n("h4",ee,a(o.title),1)):x("",!0),D(e.$slots,"default")]))}}),te={class:"flex flex-col gap-4"},le={class:"flex items-start gap-3 cursor-pointer"},ae=["onUpdate:modelValue"],se={class:"flex-1"},oe={class:"font-semibold text-foreground"},re={key:0,class:"text-sm text-muted-foreground"},ne={key:0,class:"mt-3"},ie=["onUpdate:modelValue","placeholder"],ue=E({__name:"EventApplyOptionList",props:{options:{}},emits:["update"],setup(o,{emit:e}){const{t:u}=B(),b=e,_=y({}),g=y({});return R([_,g],()=>{const s=Object.keys(_.value).filter(m=>_.value[m]).map(m=>({optionId:m,musicText:g.value[m]||void 0}));b("update",s)},{deep:!0}),(s,m)=>(r(),n("div",te,[(r(!0),n(V,null,C(o.options,d=>(r(),n("div",{key:d.id,class:"border border-default bg-surface px-4 py-3 rounded-md"},[f("label",le,[T(f("input",{type:"checkbox","onUpdate:modelValue":v=>_.value[d.id]=v,class:"mt-1 accent-foreground"},null,8,ae),[[O,_.value[d.id]]]),f("div",se,[f("p",oe,a(d.name),1),d.optionCategory?(r(),n("p",re,a(d.optionCategory),1)):x("",!0)])]),d.musicRequestUse&&_.value[d.id]?(r(),n("div",ne,[T(f("input",{"onUpdate:modelValue":v=>g.value[d.id]=v,type:"text",placeholder:l(u)("event.option.placeholder.musicRequest"),class:"w-full border border-default bg-background px-3 py-2 rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20"},null,8,ie),[[M,g.value[d.id]]])])):x("",!0)]))),128))]))}}),de={key:0,class:"max-w-[1280px] mx-auto py-10 px-5 lg:px-0 flex flex-col gap-10 bg-background text-foreground"},ce={class:"flex flex-col lg:flex-row gap-8"},pe={class:"w-full lg:w-[320px] h-[200px] bg-muted border border-default flex items-center justify-center"},fe=["src"],me={key:1,class:"text-muted-foreground text-sm"},ve={class:"flex-1 space-y-2"},_e={class:"text-2xl font-bold text-foreground"},be={key:0,class:"grid md:grid-cols-2 gap-6"},Ee=E({__name:"EventApplyView",setup(o){const{t:e}=B(),u=G(),b=j(),_=A(),g=H(),s=y(null),m=w(()=>u.params.nameEn);R(m,async()=>{if(!m.value)return;const t=await F(m.value);if(!t){b.replace({name:"error"});return}if(!t.registration_use){alert(e("user.event.apply.error.notAvailable")),b.replace({name:"event-detail",params:{nameEn:m.value}});return}s.value=t},{immediate:!0}),R(()=>_.user,t=>{if(!t){b.replace({name:"login",query:{redirect:u.fullPath}});return}g.loadMyProfile()},{immediate:!0});const v=w(()=>g.profile),S=y([]),k=y(!1),U=async()=>{if(!(!s.value||k.value)){k.value=!0;try{await Y(s.value.id,S.value),alert(e("user.event.apply.success.completed")),b.replace({name:"event-my-registrations"})}catch(t){console.error(t);const $=(t==null?void 0:t.message)==="ALREADY_REGISTERED"?e("user.event.apply.error.alreadyRegistered"):(t==null?void 0:t.message)==="REGISTRATION_NOT_STARTED"?e("user.event.apply.error.notStarted"):(t==null?void 0:t.message)==="REGISTRATION_ENDED"?e("user.event.apply.error.ended"):(t==null?void 0:t.message)==="REGISTRATION_DISABLED"?e("user.event.apply.error.disabled"):e("user.event.apply.error.unknown");alert($),(t==null?void 0:t.message)==="ALREADY_REGISTERED"&&b.replace({name:"event-my-registrations"})}finally{k.value=!1}}};return(t,$)=>s.value?(r(),n("section",de,[i(Q,{title:l(e)("user.event.apply.title.event"),"sub-title":l(e)("user.event.apply.title.apply")},null,8,["title","sub-title"]),i(I,{title:l(e)("user.event.section.eventInfo")},{default:c(()=>[f("div",ce,[f("div",pe,[s.value.thumbnailUrl?(r(),n("img",{key:0,src:s.value.thumbnailUrl,class:"w-full h-full object-cover"},null,8,fe)):(r(),n("div",me,a(l(e)("user.event.placeholder.noImage")),1))]),f("div",ve,[f("h3",_e,a(s.value.title),1),i(h,{label:l(e)("event.common.register.eventPeriod")},{default:c(()=>[p(a(s.value.periodText),1)]),_:1},8,["label"]),i(h,{label:l(e)("event.common.register.applyPeriod")},{default:c(()=>[p(a(s.value.applyPeriodText),1)]),_:1},8,["label"]),i(h,{label:l(e)("user.event.label.price")},{default:c(()=>[p(a(s.value.payinfoHtml?l(e)("user.event.label.paid"):l(e)("user.event.label.free")),1)]),_:1},8,["label"])])])]),_:1},8,["title"]),i(I,{title:l(e)("user.event.section.applicantInfo")},{default:c(()=>[v.value?(r(),n("div",be,[i(h,{label:l(e)("user.event.label.name")},{default:c(()=>[p(a(v.value.name),1)]),_:1},8,["label"]),i(h,{label:l(e)("user.event.label.nickname")},{default:c(()=>[p(a(v.value.nickname),1)]),_:1},8,["label"]),i(h,{label:l(e)("user.event.label.gender")},{default:c(()=>[p(a(v.value.gender),1)]),_:1},8,["label"]),i(h,{label:l(e)("user.event.label.nationality")},{default:c(()=>[p(a(v.value.nationality),1)]),_:1},8,["label"])])):x("",!0)]),_:1},8,["title"]),s.value.options.length?(r(),L(I,{key:0,title:l(e)("event.option.section.available")},{default:c(()=>[i(ue,{options:s.value.options,onUpdate:$[0]||($[0]=N=>S.value=N)},null,8,["options"])]),_:1},8,["title"])):x("",!0),i(q,{size:"xlarge",type:"primary",class:"w-full",loading:k.value,onClick:U},{default:c(()=>[p(a(l(e)("user.event.apply.button.submit")),1)]),_:1},8,["loading"])])):x("",!0)}});export{Ee as default};
