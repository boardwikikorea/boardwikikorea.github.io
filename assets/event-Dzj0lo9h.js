import{n as r,s,Q as i}from"./index-Bd0HrmgB.js";async function o(){return r(async()=>{const{data:t,error:e}=await s.from("event").select(`
        id,
        name,
        name_en,
        open,
        start_date,
        end_date,
        registration_use,
        registration_start_at,
        registration_end_at,
        status,
        event_cate,
        created_at
      `).order("created_at",{ascending:!1});if(e)throw e;return t??[]})}async function c(t){return r(async()=>{const{data:e,error:n}=await s.from("event").select("*").eq("id",t).single();if(n)throw n;return e})}async function d(t){return r(async()=>{const e={name:t},{data:n,error:a}=await s.from("event").insert(e).select("id").single();if(a)throw a;return n.id})}async function l(t,e){return r(async()=>{const{error:n}=await s.from("event").update(e).eq("id",t);if(n)throw n})}async function u(t){return r(async()=>{const{data:e,error:n}=await s.from("event_link").select("*").eq("event_id",t).order("sort_order").order("created_at");if(n)throw n;return e??[]})}async function h(t){return r(async()=>{const{data:e,error:n}=await s.from("event_link").insert(t).select("*").single();if(n)throw n;return e})}async function f(t){return r(async()=>{const{error:e}=await s.from("event_link").delete().eq("id",t);if(e)throw e})}async function y(t){return r(async()=>{const{data:e,error:n}=await s.from("event_option").select("*").eq("event_id",t).order("sort_order").order("created_at");if(n)throw n;return e??[]})}async function w(t){return r(async()=>{const{data:e,error:n}=await s.from("event_option").insert(t).select("*").single();if(n)throw n;return e})}async function _(t){return r(async()=>{const{error:e}=await s.from("event_option").delete().eq("id",t);if(e)throw e})}async function v(t){return r(async()=>{const{data:e,error:n}=await s.from("event_schedule").select("*").eq("event_id",t).order("schedule_date").order("sort_order").order("start_time").order("created_at");if(n)throw n;return e??[]})}async function p(t){return r(async()=>{const{data:e,error:n}=await s.from("event_schedule").insert(t).select("*").single();if(n)throw n;return e})}async function g(t){return r(async()=>{const{error:e}=await s.from("event_schedule").delete().eq("id",t);if(e)throw e})}const k=i("admin-event",{state:()=>({events:[],currentEvent:null,links:[],options:[],schedules:[],loading:!1,linksLoading:!1,optionsLoading:!1,schedulesLoading:!1}),actions:{async fetchEvents(){this.loading=!0;try{this.events=await o()}finally{this.loading=!1}},async createDraftEvent(t){return await d(t)},async fetchEventDetail(t){this.loading=!0;try{this.currentEvent=await c(t),await Promise.all([this.fetchLinks(t),this.fetchOptions(t),this.fetchSchedules(t)])}finally{this.loading=!1}},async updateEvent(t,e){await l(t,e),this.currentEvent&&this.currentEvent.id===t&&Object.assign(this.currentEvent,e)},async fetchLinks(t){this.linksLoading=!0;try{this.links=await u(t)}finally{this.linksLoading=!1}},async addLink(t,e){const n=await h({event_id:t,type:e.type,title:e.title,link:e.link});return this.links.push(n),n},async deleteLink(t){await f(t),this.links=this.links.filter(e=>e.id!==t)},async fetchOptions(t){this.optionsLoading=!0;try{this.options=await y(t)}finally{this.optionsLoading=!1}},async addOption(t,e){const n=await w({event_id:t,...e});return this.options.push(n),n},async deleteOption(t){await _(t),this.options=this.options.filter(e=>e.id!==t)},async fetchSchedules(t){this.schedulesLoading=!0;try{this.schedules=await v(t)}finally{this.schedulesLoading=!1}},async addSchedule(t,e){const n=await p({event_id:t,...e});return this.schedules.push(n),n},async deleteSchedule(t){await g(t),this.schedules=this.schedules.filter(e=>e.id!==t)}}});export{k as u};
