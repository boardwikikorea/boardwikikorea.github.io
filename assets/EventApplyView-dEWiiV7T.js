import{M as A,q as $,d as E,c as n,b as t,i as c,t as l,o as i,B as D,r as b,f as k,F as N,h as U,a as h,k as S,N as P,v as V,g as R,E as B,m as p,A as x,D as C,z as O}from"./index-B1y5lJEh.js";import{f as M}from"./profile-BvzN8Xu3.js";import{c as G}from"./eventPublic-SonXkaWR.js";import{a as L}from"./eventPublicRegistration-DTAXvmpl.js";const j=A("profile",{state:()=>({profile:null,loading:!1,_loadedUserId:null}),getters:{isReady:u=>!!u.profile},actions:{async loadMyProfile(){const o=$().user;if(!o){this.$reset();return}if(!(this._loadedUserId===o.id&&this.profile)){this.loading=!0;try{const a=await M(o.id);this.profile=a,this._loadedUserId=o.id}catch(a){console.error("[profileStore] load failed",a),this.profile=null,this._loadedUserId=null}finally{this.loading=!1}}},resetProfile(){this.$reset()}}}),q={class:"font-bold text-[22px] lg:text-[32px]"},z={class:"text-[var(--btn-primary-bg)]"},F=E({__name:"SubTitle",props:{title:{},subTitle:{}},setup(u){return(o,a)=>(i(),n("h2",q,[t("span",z,l(u.title),1),c(" "+l(u.subTitle),1)]))}}),Y={class:"text-[16px] font-bold tracking-[-0.05em] text-black dark:text-white flex flex-row gap-2"},H={class:"font-normal"},v=E({__name:"InfoItem",props:{label:{},value:{}},setup(u){return(o,a)=>(i(),n("p",Y,[c(l(u.label)+" ",1),t("span",H,[D(o.$slots,"default",{},()=>[c(l(u.value),1)])])]))}}),J={class:"flex flex-col gap-4"},K={class:"flex items-start gap-3 cursor-pointer"},Q=["onUpdate:modelValue"],W={class:"flex-1"},X={class:"font-semibold text-foreground"},Z={key:0,class:"text-sm text-muted-foreground"},ee={key:0,class:"mt-3"},te=["onUpdate:modelValue"],se=E({__name:"EventApplyOptionList",props:{options:{}},emits:["update"],setup(u,{emit:o}){const a=o,_=b({}),g=b({});return k([_,g],()=>{const s=Object.keys(_.value).filter(f=>_.value[f]).map(f=>({optionId:f,musicText:g.value[f]||void 0}));a("update",s)},{deep:!0}),(s,f)=>(i(),n("div",J,[(i(!0),n(N,null,U(u.options,d=>(i(),n("div",{key:d.id,class:"border border-default bg-surface px-4 py-3 rounded-md"},[t("label",K,[S(t("input",{type:"checkbox","onUpdate:modelValue":m=>_.value[d.id]=m,class:"mt-1 accent-foreground"},null,8,Q),[[P,_.value[d.id]]]),t("div",W,[t("p",X,l(d.name),1),d.optionCategory?(i(),n("p",Z,l(d.optionCategory),1)):h("",!0)])]),d.musicRequestUse&&_.value[d.id]?(i(),n("div",ee,[S(t("input",{"onUpdate:modelValue":m=>g.value[d.id]=m,type:"text",placeholder:"음악 요청 사항 (선택)",class:"w-full border border-default bg-background px-3 py-2 rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20"},null,8,te),[[V,g.value[d.id]]])])):h("",!0)]))),128))]))}}),le={key:0,class:"max-w-[1280px] mx-auto py-10 px-5 lg:px-0 flex flex-col gap-10 bg-background text-foreground"},ae={class:"border border-default bg-surface px-8 py-7"},oe={class:"flex flex-col lg:flex-row gap-8"},re={class:"w-full lg:w-[320px] h-[200px] bg-muted border border-default flex items-center justify-center"},ne=["src"],ie={key:1,class:"text-muted-foreground text-sm"},ue={class:"flex-1 space-y-2"},de={class:"text-2xl font-bold text-foreground"},ce={class:"border border-default bg-surface px-8 py-7"},fe={key:0,class:"grid md:grid-cols-2 gap-6"},pe={key:0,class:"border border-default bg-surface px-8 py-7"},ve=E({__name:"EventApplyView",setup(u){const o=B(),a=O(),_=$(),g=j(),s=b(null),f=R(()=>o.params.nameEn);k(f,async()=>{if(!f.value)return;const e=await G(f.value);if(!e){a.replace({name:"error"});return}if(!e.registration_use){alert("신청이 불가능한 이벤트입니다."),a.replace({name:"event-detail",params:{nameEn:f.value}});return}s.value=e},{immediate:!0}),k(()=>_.user,e=>{if(!e){a.replace({name:"login",query:{redirect:o.fullPath}});return}g.loadMyProfile()},{immediate:!0});const m=R(()=>g.profile),T=b([]),y=b(!1),I=async()=>{if(!(!s.value||y.value)){y.value=!0;try{await L(s.value.id,T.value),alert("이벤트 신청이 완료되었습니다."),a.replace({name:"event-my-registrations"})}catch(e){console.error(e);const r=(e==null?void 0:e.message)==="ALREADY_REGISTERED"?"이미 신청한 이벤트입니다.":(e==null?void 0:e.message)==="REGISTRATION_NOT_STARTED"?"신청 기간이 아직 시작되지 않았습니다.":(e==null?void 0:e.message)==="REGISTRATION_ENDED"?"신청 기간이 종료되었습니다.":(e==null?void 0:e.message)==="REGISTRATION_DISABLED"?"현재 신청이 불가능한 이벤트입니다.":"신청 중 오류가 발생했습니다.";alert(r),(e==null?void 0:e.message)==="ALREADY_REGISTERED"&&a.replace({name:"event-my-registrations"})}finally{y.value=!1}}};return(e,r)=>s.value?(i(),n("section",le,[p(F,{title:"이벤트","sub-title":"신청"}),t("article",ae,[r[1]||(r[1]=t("h4",{class:"text-xl font-bold mb-4 text-foreground"}," 이벤트 정보 ",-1)),t("div",oe,[t("div",re,[s.value.thumbnailUrl?(i(),n("img",{key:0,src:s.value.thumbnailUrl,class:"w-full h-full object-cover"},null,8,ne)):(i(),n("div",ie," No Image "))]),t("div",ue,[t("h3",de,l(s.value.title),1),p(v,{label:"이벤트 기간"},{default:x(()=>[c(l(s.value.periodText),1)]),_:1}),p(v,{label:"신청 기간"},{default:x(()=>[c(l(s.value.applyPeriodText),1)]),_:1}),p(v,{label:"비용"},{default:x(()=>[c(l(s.value.payinfoHtml?"유료":"무료"),1)]),_:1})])])]),t("article",ce,[r[2]||(r[2]=t("h4",{class:"text-xl font-bold mb-4 text-foreground"}," 신청자 정보 ",-1)),m.value?(i(),n("div",fe,[p(v,{label:"이름"},{default:x(()=>[c(l(m.value.name),1)]),_:1}),p(v,{label:"닉네임"},{default:x(()=>[c(l(m.value.nickname),1)]),_:1}),p(v,{label:"성별"},{default:x(()=>[c(l(m.value.gender),1)]),_:1}),p(v,{label:"국적"},{default:x(()=>[c(l(m.value.nationality),1)]),_:1})])):h("",!0)]),s.value.options.length?(i(),n("article",pe,[r[3]||(r[3]=t("h4",{class:"text-xl font-bold mb-4 text-foreground"}," 이벤트 옵션 ",-1)),p(se,{options:s.value.options,onUpdate:r[0]||(r[0]=w=>T.value=w)},null,8,["options"])])):h("",!0),p(C,{size:"xlarge",type:"primary",class:"w-full",loading:y.value,onClick:I},{default:x(()=>[...r[4]||(r[4]=[c(" 신청 완료 ",-1)])]),_:1},8,["loading"])])):h("",!0)}});export{ve as default};
