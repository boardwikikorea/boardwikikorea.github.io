import{w as j,s as E,b as B,d as V,e as q,u as A,r as R,f as F,g as L,c as o,i as t,l as h,t as s,a,m as D,j as N,v as T,F as v,k as f,o as i,n as C,p as I}from"./index-DNVwaNb1.js";async function M(c){return j(async()=>{const{data:n,error:l}=await E.from("event_registration").select(`
        id,
        event_id,
        state,
        created_at,
        profile:profile_id (
          id,
          nickname
        ),
        options:event_registration_option (
          id,
          music_text,
          event_option (
            id,
            name,
            code,
            option_category,
            gender_type,
            round_type,
            music_request_use,
            countable
          )
        )
      `).eq("event_id",c).order("created_at",{ascending:!1});if(l)throw l;return(n??[]).map(u=>({...u,profile:Array.isArray(u.profile)?u.profile[0]??null:u.profile}))})}async function z(c,n){return j(async()=>{const{error:l}=await E.from("event_registration").update({state:n}).eq("id",c);if(l)throw l})}const P=B("admin-event-registration",{state:()=>({registrations:[],loading:!1}),actions:{async fetchByEvent(c){this.loading=!0;try{this.registrations=await M(c)}finally{this.loading=!1}},async updateState(c,n){await z(c,n);const l=this.registrations.find(u=>u.id===c);l&&(l.state=n)}}}),U={class:"p-6 bg-neutral-50 dark:bg-neutral-900 min-h-[calc(100vh-54px)]"},G={class:"flex items-center justify-between mb-2"},H={class:"text-lg font-semibold text-neutral-800 dark:text-neutral-100"},J={class:"text-sm text-neutral-600 dark:text-neutral-400 mb-6"},K={key:0,class:"text-sm text-neutral-500 dark:text-neutral-400 mb-4"},O={class:"mb-6 flex flex-wrap items-center gap-4 justify-between"},Q={class:"flex flex-wrap items-center gap-4"},W=["placeholder"],X={class:"flex gap-2"},Y=["onClick"],Z={class:"overflow-x-auto bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-lg shadow-sm"},tt={class:"w-full border-collapse"},et={class:"bg-neutral-100 dark:bg-neutral-700"},nt={class:"px-4 py-3 text-xs font-semibold text-left"},st={class:"px-4 py-3 text-xs font-semibold text-center"},at={class:"px-4 py-3 text-xs font-semibold text-left"},rt={class:"px-4 py-3 text-xs font-semibold text-center w-40"},ot={class:"px-4 py-3 text-center text-sm text-neutral-500"},it={class:"px-4 py-3"},lt={class:"text-sm text-neutral-900 dark:text-neutral-100"},dt={class:"px-4 py-3 text-center"},ct={class:"flex flex-col items-center gap-1"},ut={key:0,class:"flex gap-1 mt-1"},pt=["onClick"],xt=["onClick"],gt={class:"px-4 py-3 text-sm"},_t={key:0},mt={key:0,class:"text-xs text-neutral-500"},ht={key:1},bt={class:"px-4 py-3 text-center text-sm"},vt={key:0},ft={colspan:"5",class:"px-4 py-10 text-center text-sm text-neutral-500"},kt=V({__name:"RegistrationListView",setup(c){const{t:n}=q(),l=A(),u=D(),S=l.params.eventId,x=P(),b=R(""),$=["all","pending","approved","rejected"],m=R("all");async function y(d,r){if(confirm(n(`admin.eventRegistration.confirm.${r}`)))try{await x.updateState(d.id,r)}catch(e){alert(n("admin.eventRegistration.alert.updateError")),console.error(e)}}F(async()=>{try{await x.fetchByEvent(S)}catch(d){console.error(n("admin.eventRegistration.alert.listError"),d)}});const k=L(()=>{let d=x.registrations??[];m.value!=="all"&&(d=d.filter(e=>e.state===m.value));const r=b.value.trim().toLowerCase();return r&&(d=d.filter(e=>{var g,_;return(_=(g=e.profile)==null?void 0:g.nickname)==null?void 0:_.toLowerCase().includes(r)})),d});return(d,r)=>(i(),o("main",U,[t("div",G,[t("h3",H,s(a(n)("admin.eventRegistration.listTitle")),1),t("button",{onClick:r[0]||(r[0]=e=>a(u).back()),class:"px-4 py-2 text-sm rounded-md bg-neutral-900 text-white hover:bg-neutral-800 dark:bg-white dark:text-neutral-900 dark:hover:bg-neutral-200"}," â† "+s(a(n)("common.button.back")),1)]),t("p",J,s(a(n)("admin.eventRegistration.listDescription")),1),a(x).loading?(i(),o("div",K,s(a(n)("common.loading")),1)):h("",!0),t("div",O,[t("div",Q,[N(t("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>b.value=e),type:"text",placeholder:a(n)("admin.eventRegistration.searchPlaceholder"),class:"w-64 px-3 py-2 text-sm rounded-md border border-neutral-300 bg-white text-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-400 dark:bg-neutral-800 dark:text-neutral-100 dark:border-neutral-600"},null,8,W),[[T,b.value]]),t("div",X,[(i(),o(v,null,f($,e=>t("button",{key:e,onClick:g=>m.value=e,class:C(["px-3 py-1.5 text-sm rounded-full border transition",m.value===e?"bg-neutral-900 text-white border-neutral-900 dark:bg-white dark:text-neutral-900":"bg-white text-neutral-700 border-neutral-300 hover:bg-neutral-100 dark:bg-neutral-800 dark:text-neutral-200 dark:border-neutral-600 dark:hover:bg-neutral-700"])},s(a(n)(`admin.eventRegistration.filter.${e}`)),11,Y)),64))])])]),t("div",Z,[t("table",tt,[t("thead",et,[t("tr",null,[r[2]||(r[2]=t("th",{class:"px-4 py-3 text-xs font-semibold text-center w-16"},"#",-1)),t("th",nt,s(a(n)("admin.eventRegistration.table.user")),1),t("th",st,s(a(n)("admin.eventRegistration.table.state")),1),t("th",at,s(a(n)("admin.eventRegistration.table.option")),1),t("th",rt,s(a(n)("admin.eventRegistration.table.createdAt")),1)])]),t("tbody",null,[(i(!0),o(v,null,f(k.value,(e,g)=>{var _,w;return i(),o("tr",{key:e.id,class:"border-t border-neutral-200 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-700 transition"},[t("td",ot,s(g+1),1),t("td",it,[t("span",lt,s(((_=e.profile)==null?void 0:_.nickname)??"-"),1)]),t("td",dt,[t("div",ct,[t("span",{class:C(["inline-flex px-2 py-1 text-xs rounded-full",{"bg-yellow-100 text-yellow-700":e.state==="pending","bg-green-100 text-green-700":e.state==="approved","bg-red-100 text-red-700":e.state==="rejected"}])},s(a(n)(`admin.eventRegistration.state.${e.state}`)),3),e.state==="pending"?(i(),o("div",ut,[t("button",{onClick:p=>y(e,"approved"),class:"px-2 py-0.5 text-xs rounded bg-green-600 text-white hover:bg-green-700"},s(a(n)("admin.eventRegistration.action.approve")),9,pt),t("button",{onClick:p=>y(e,"rejected"),class:"px-2 py-0.5 text-xs rounded bg-red-600 text-white hover:bg-red-700"},s(a(n)("admin.eventRegistration.action.reject")),9,xt)])):h("",!0)])]),t("td",gt,[(w=e.options)!=null&&w.length?(i(),o("div",_t,[(i(!0),o(v,null,f(e.options,p=>(i(),o("div",{key:p.id,class:"mb-1"},[I(s(p.event_option.name)+" ",1),p.music_text?(i(),o("span",mt," ("+s(p.music_text)+") ",1)):h("",!0)]))),128))])):(i(),o("span",ht,"-"))]),t("td",bt,s(e.created_at),1)])}),128)),!a(x).loading&&k.value.length===0?(i(),o("tr",vt,[t("td",ft,s(a(n)("admin.eventRegistration.empty")),1)])):h("",!0)])])])]))}});export{kt as default};
