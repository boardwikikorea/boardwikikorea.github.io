<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>롱보드 대축제</title>

    <!-- SEO 최적화 -->
    <meta name="description" content="보드위키에서 최신 스케이트, 롱보드 정보와 롱보드댄싱, 보드대회 소식을 확인하세요.">
    <meta name="keywords" content="스케이트, 롱보드, 카버보드, 롱보드댄싱, 보드대회, longboarding, 롱보드 대축제, 롱보드 페스티벌, longboard festival">
    <meta name="naver-site-verification" content="e74dc3e49d0527046508b26ee9860c52a501b8f4">

    <!-- Open Graph (OG) -->
    <meta property="og:site_name" content="BoardWiki">
    <meta property="og:title" content="롱보드 대축제">
    <meta property="og:description" content="스케이트·롱보드 최신 정보를 확인하세요.">
    <meta property="og:url" content="https://boardwiki.kr">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://boardwiki.kr/images/og-image.jpg?ver=20250930">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="보드위키 - 스케이트·롱보드 커뮤니티">
    <meta name="twitter:description" content="보드위키에서 최신 스케이트, 롱보드 정보를 만나보세요.">
    <meta name="twitter:image" content="https://boardwiki.kr/images/twitter-image.jpg">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://boardwiki.kr/">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/common.css?ver250314">
    <link rel="stylesheet" href="../css/festival.css?ver=250317">

    <!-- JS -->
    <script src="../js/common.js" defer></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDDkghHYAD581-N3u8zUUsinS1F49P5xi0",
    authDomain: "boardwiki-e070e.firebaseapp.com",
    projectId: "boardwiki-e070e",
    storageBucket: "boardwiki-e070e.appspot.com",
    messagingSenderId: "301441212066",
    appId: "1:301441212066:web:1ffff5d8eccaaff11781fb",
    measurementId: "G-DZ52LV9MMG"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function fetchAllApplications() {
    const querySnapshot = await getDocs(collection(db, "festivalApplications"));
    const allData = [];

    querySnapshot.forEach((doc) => {
      const data = doc.data();
      allData.push({ id: doc.id, ...data });
    });

    // 1️⃣ createdAt 기준으로 최신순 정렬
    allData.sort((a, b) => {
      const timeA = a.createdAt?.toDate ? a.createdAt.toDate().getTime() : 0;
      const timeB = b.createdAt?.toDate ? b.createdAt.toDate().getTime() : 0;
      return timeB - timeA;
    });

    // 2️⃣ 이름 기준으로 중복 제거
    const uniqueData = [];
    const seenNames = new Set();

    for (const entry of allData) {
      const name = entry.name?.trim();
      if (name && !seenNames.has(name)) {
        uniqueData.push(entry);
        seenNames.add(name);
      }
    }

    // 3️⃣ 카테고리별 분류
    const categories = {
      "프리스타일 (Freestyle) No Sponsor_(남, Male)": [],
      "프리스타일 (Freestyle) No Sponsor_(여, Female)": [],
      "프리스타일 (Freestyle) 오픈 (Open)_(남, Male)": [],
      "프리스타일 (Freestyle) 오픈 (Open)_(여, Female)": [],
      "프리스타일 (Freestyle) 마스터 (Master)": [],
      "페어 Pair": [],
      "히피점프 Hippy Jump": [],
      "레이스 Race": []
    };

    uniqueData.forEach((d) => {
      const gender = d.gender === "male" ? "남, Male" : "여, Female";

      if (d.freestyle === "none") return;

      if (d.freestyle === "amateur") categories[`프리스타일 (Freestyle) No Sponsor_(${gender})`]?.push(d.name);
      if (d.freestyle === "open") categories[`프리스타일 (Freestyle) 오픈 (Open)_(${gender})`]?.push(d.name);
      if (d.freestyle === "master") categories["프리스타일 (Freestyle) 마스터 (Master)"]?.push(d.name);

      if (d.bestPair) categories["페어 Pair"].push(d.name);
      if (d.hippyJump) categories["히피점프 Hippy Jump"].push(d.name);
      if (d.race) categories["레이스 Race"].push(d.name);
    });

    // 4️⃣ 화면 렌더링
    const container = document.querySelector(".category-list");
    container.innerHTML = "";

    for (const [category, names] of Object.entries(categories)) {
      const section = document.createElement("section");
      section.innerHTML = `
        <h3 style="margin-top: 1.5rem;">${category} - ${names.length}명</h3>
        <ul style="padding-left: 1rem;">
          ${names.map(name => `<li>${name}</li>`).join("")}
        </ul>
      `;
      container.appendChild(section);
    }
  }

  // 🔒 관리자 비밀번호로 접근 제어
  window.onload = () => {
    fetchAllApplications();
  };
</script>


  <style>
    .category-list { margin-bottom: 3rem; }
    .category-list h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #ccc;
      padding-bottom: 0.5rem;
    }

    .category-list ul {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      border-top:1px solid #ddd;
    }

    .category-list li{
      border: 1px solid #ddd;
      border-top:0;
      padding: 0.75rem;
      text-align: center;
    }


    .category-list li:nth-child(even){
      background-color: #fafafa;
    }

    button#fetch-all-reservations {
      background-color: #333;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button#fetch-all-reservations:hover {
      background-color: #555;
    }
  </style>
</head>

<body id="festival">
  <h1 class="sound_only">롱보드 대축제</h1>

    <div class="language-switcher">
        <button type="button" class="active" id="btn-kr">KR</button>
        <button type="button" id="btn-en">EN</button>
    </div>

    
  <div class="wrap main">


  
    <article class="content">

      <div class="form-header">
        <h2>참가자 목록 (Participant List)</h2>
        <a href="./index.html" class="close-btn">✖</a>
      </div>
      
      <div class="category-list" style="margin-top: 2rem;">

      </div>

    </article>
    <footer>서비스 제공 <a href="../index.html">@boardwiki</a></footer>
  </div>
</body>
</html>
