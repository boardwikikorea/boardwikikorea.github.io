<!DOCTYPE html>
<html lang="ko">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>롱보드 대축제</title>

    <!-- SEO 최적화 -->
    <meta name="description" content="보드위키에서 최신 스케이트, 롱보드 정보와 롱보드댄싱, 보드대회 소식을 확인하세요.">
    <meta name="keywords" content="스케이트, 롱보드, 카버보드, 롱보드댄싱, 보드대회, longboarding, 롱보드 대축제, 롱보드 페스티벌, longboard festival">
    <meta name="naver-site-verification" content="e74dc3e49d0527046508b26ee9860c52a501b8f4">

    <!-- Open Graph (OG) -->
    <meta property="og:site_name" content="BoardWiki">
    <meta property="og:title" content="롱보드 대축제">
    <meta property="og:description" content="스케이트·롱보드 최신 정보를 확인하세요.">
    <meta property="og:url" content="https://boardwiki.kr">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://boardwiki.kr/images/og-image.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="보드위키 - 스케이트·롱보드 커뮤니티">
    <meta name="twitter:description" content="보드위키에서 최신 스케이트, 롱보드 정보를 만나보세요.">
    <meta name="twitter:image" content="https://boardwiki.kr/images/twitter-image.jpg">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://boardwiki.kr/">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/common.css?ver250314">
    <link rel="stylesheet" href="../css/festival.css?ver=250317">

    <!-- JS -->
    <script src="../js/common.js" defer></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDDkghHY...", // 실제 키로 교체
      authDomain: "boardwiki-e070e.firebaseapp.com",
      projectId: "boardwiki-e070e",
      storageBucket: "boardwiki-e070e.appspot.com",
      messagingSenderId: "301441212066",
      appId: "1:301441212066:web:1ffff5d8eccaaff11781fb",
      measurementId: "G-DZ52LV9MMG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);



    function shuffleWithSeed(array, seed) {
      const result = [...array];
      for (let i = result.length - 1; i > 0; i--) {
        // 시드를 조합해 고정된 랜덤값 생성
        const rand = seededRandom(seed + i);
        const j = Math.floor(rand * (i + 1));
        [result[i], result[j]] = [result[j], result[i]];
      }
      return result;
    }

    function seededRandom(seed) {
      let x = Math.sin(seed) * 10000;
      return x - Math.floor(x);
    }

    async function fetchAllApplications() {
      const querySnapshot = await getDocs(collection(db, "festivalApplications"));

      const seed = 1; // 원하는 고정 시드 (날짜나 대회 ID 등)
      const shuffledDocs = shuffleWithSeed(querySnapshot.docs, seed);


      const categories = {
        "트릭_오픈_남": [], "트릭_오픈_여": [],
        "트릭_일반_남": [], "트릭_일반_여": [],
        "댄싱_오픈_남": [], "댄싱_오픈_여": [],
        "댄싱_일반_남": [], "댄싱_일반_여": [],
        "프리_오픈_남": [], "프리_오픈_여": [],
        "프리_일반_남": [], "프리_일반_여": [],
        "프리_뉴비": [],
        "쥐턴": [], "핸트": [], "페어": [], "히피": []
      };

      let totalCount = 0;

      console.log(querySnapshot);

      shuffledDocs.forEach((doc) => {
        const data = doc.data();

        const info = {
          id: doc.id,
          name: data.name || "",
          contact: data.contact || "",
          pay: data.pay || false,
          after_party: data.after_party || false,
          song : data.song,
          after_party_num: data.after_party_num || "1"
        };

        const gender = data.gender === "female" ? "여" : "남";
        const trickLevel = data.trick_level || "";
        const dancingLevel = data.dancing_level || "";

        if (data.best_trick === "open")
            categories[`트릭_오픈_${gender}`]?.push(info), totalCount++;

        if (data.best_trick === "amateur")
            categories[`트릭_일반_${gender}`]?.push(info), totalCount++;

        if (data.best_dancing === "open")
            categories[`댄싱_오픈_${gender}`]?.push(info), totalCount++;

        if (data.best_dancing === "amateur")
            categories[`댄싱_일반_${gender}`]?.push(info), totalCount++;

        if (data.freestyle === "newbie")
          categories["프리_뉴비"].push(info), totalCount++;

        if (data.freestyle === "open")
          categories[`프리_오픈_${gender}`]?.push(info), totalCount++;

        if (data.freestyle === "amateur")
          categories[`프리_일반_${gender}`]?.push(info), totalCount++;

        if (data.best_gturn)
          categories["쥐턴"].push(info), totalCount++;

        if (data.best_hand)
          categories["핸트"].push(info), totalCount++;

        if (data.best_pair)
          categories["페어"].push(info), totalCount++;

        if (data.hippy_jump)
          categories["히피"].push(info), totalCount++;
      });

      const content = document.querySelector(".category-list");
      /*
      content.innerHTML = `
        <div class="summary-box">
          ✅ 총 신청자 수: <strong>${totalCount}</strong>명
        </div>
      `;
      */

      for (const [categoryKey, participants] of Object.entries(categories)) {
        if (participants.length === 0) continue;

        let title = categoryKey
          .replace("트릭_", "트릭 (Trick) ")
          .replace("댄싱_", "댄싱 (Dancing) ")
          .replace("프리_", "프리스타일 (Freestyle) ")
          .replace("남", "(남, Male)").replace("여", "(여, Female)")
          .replace("오픈", "오픈 (Open)").replace("일반", "No Sponsor").replace("뉴비", "뉴비 (Newbie)");


        const section = document.createElement("section");
        section.classList.add("category-section");
        //<th>노래</th>
        //<td style="font-size: 0.7rem;">${p.song}</td></tr>
        //<th>전화번호</th>
        //<td>${p.contact}</td>
        section.innerHTML = `
          <h2>${title} - ${participants.length}명</h2>
          <table>
            <thead>
              <tr><th>이름</th></tr>
            </thead>
            <tbody>
              ${participants.map(p => `<tr><td data-id="${p.id}">${p.name}</td>`).join("")}
            </tbody>
          </table>
        `;
        content.appendChild(section);
      }
    }

    window.onload = () => {
      fetchAllApplications();

      document.getElementById('fetch-all-reservations')
        ?.addEventListener('click', fetchAllApplications);
    };

            document.addEventListener("DOMContentLoaded", function() {
            const btnKr = document.getElementById("btn-kr");
            const btnEn = document.getElementById("btn-en");
            const krElements = document.querySelectorAll(".lang_kr");
            const enElements = document.querySelectorAll(".lang_en");

            function showKorean() {
                krElements.forEach(el => el.style.display = "block");
                enElements.forEach(el => el.style.display = "none");
                btnKr.classList.add("active");
                btnEn.classList.remove("active");
            }

            function showEnglish() {
                krElements.forEach(el => el.style.display = "none");
                enElements.forEach(el => el.style.display = "block");
                btnEn.classList.add("active");
                btnKr.classList.remove("active");
            }

            // 초기 상태 설정: 브라우저 언어 감지
            const userLang = navigator.language || navigator.userLanguage; // 사용자의 브라우저 언어 감지
            if (userLang.startsWith("ko")) {
                showKorean(); // 한국어이면 한국어 노출
            } else {
                showEnglish(); // 그 외에는 영어 노출
            }

            // 버튼 클릭 이벤트 설정
            btnKr.addEventListener("click", showKorean);
            btnEn.addEventListener("click", showEnglish);
        });

  </script>

  <style>
    .category-section { margin-bottom: 3rem; }
    .category-section h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #ccc;
      padding-bottom: 0.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: center;
    }

    thead {
      background-color: #f0f0f0;
    }

    tr:nth-child(even) {
      background-color: #fafafa;
    }

    button#fetch-all-reservations {
      background-color: #333;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button#fetch-all-reservations:hover {
      background-color: #555;
    }
  </style>
</head>

<body id="festival">
  <h1 class="sound_only">롱보드 대축제</h1>

    <div class="language-switcher">
        <button type="button" class="active" id="btn-kr">KR</button>
        <button type="button" id="btn-en">EN</button>
    </div>

    
  <div class="wrap main">


  
    <article class="content">

      <div class="form-header">
        <h2 class="lang_kr">참가자 목록</h2>
        <h2 class="lang_en">Participant List</h2>
        <a href="./index.html" class="close-btn">✖</a>
      </div>
      
      <div class="category-list" style="margin-top: 2rem;"></div>
    </article>
    <footer>서비스 제공 <a href="../index.html">@boardwiki</a></footer>
  </div>
</body>
</html>
